<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Luyện Tập Code</title>
    <link rel="stylesheet" href="/sinhvien/css/student.css">
    <link rel="stylesheet" href="/admin/css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-wrapper">
        <aside class="admin-sidebar">
            <div class="logo" style="margin-bottom: 2rem;">Admin<span>Panel</span></div>
            <div class="admin-nav-item active" onclick="showTab('dashboard')">Thống kê chung</div>
            <div class="admin-nav-item" onclick="showTab('problems')">Quản lý bài tập</div>
            <div class="admin-nav-item" onclick="showTab('students')">Sinh viên</div>
            <div class="admin-nav-item" onclick="showTab('reports')">Báo cáo</div>
            <div class="admin-nav-item" onclick="showTab('submissions')">Lịch sử nộp bài</div>
            <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid #30363d;">
                <a href="/api/auth/logout" style="text-decoration: none; color: #ff7b72; font-size: 0.9rem;">Đăng xuất</a>
            </div>
        </aside>
        
        <main class="admin-main">
            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="admin-tab">
                <h2 style="margin-bottom: 2rem;">Tổng quan hệ thống</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="label">Tổng bài tập</div>
                        <div id="stat-problems" class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Tổng sinh viên</div>
                        <div id="stat-students" class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Lượt truy cập</div>
                        <div id="stat-hits" class="value">0</div>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-container">
                        <h3>Phân bố ngôn ngữ</h3>
                        <div id="lang-stats" class="lang-bar-wrapper">
                            <!-- Progress bars here -->
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Hoạt động mới nhất</h3>
                        <table class="data-table" style="font-size: 0.85rem;">
                            <thead>
                                <tr>
                                    <th>SV</th>
                                    <th>Bài tập</th>
                                    <th>Ngôn ngữ</th>
                                    <th>Thời gian</th>
                                </tr>
                            </thead>
                            <tbody id="recent-activity-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Management Tabs -->
            <div id="tab-problems" class="admin-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Quản lý bài tập</h2>
                    <button class="primary-btn" onclick="openProblemModal()">+ Thêm bài mới</button>
                </div>
                
                <div class="search-row">
                    <input type="text" class="search-input" id="search-problems" placeholder="Sách bài tập theo tên, chủ đề..." oninput="onSearch('problems')">
                    <select class="search-input" id="filter-problems-category" onchange="onFilter('problems')" style="flex: 0 0 200px;">
                        <option value="all">Tất cả chủ đề</option>
                        <option value="Level 1">Level 1: Nhập xuất</option>
                        <option value="Level 2">Level 2: Rẽ nhánh</option>
                        <option value="Level 3">Level 3: Vòng lặp</option>
                        <option value="Level 4">Level 4: Mảng & Chuỗi</option>
                        <option value="Level 5">Level 5: Nâng cao</option>
                    </select>
                    <select class="search-input" id="filter-problems-difficulty" onchange="onFilter('problems')" style="flex: 0 0 150px;">
                        <option value="all">Mức độ</option>
                        <option value="Dễ">Dễ</option>
                        <option value="Trung bình">Trung bình</option>
                        <option value="Khó">Khó</option>
                    </select>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th onclick="onSort('problems', 'id')">ID</th>
                            <th onclick="onSort('problems', 'title')">Tiêu đề</th>
                            <th onclick="onSort('problems', 'difficulty')">Mức độ</th>
                            <th onclick="onSort('problems', 'category')">Chủ đề</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="problems-body"></tbody>
                </table>

                <div class="pagination-row" id="pagination-problems"></div>
            </div>

            <div id="tab-students" class="admin-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Quản lý sinh viên</h2>
                    <button class="primary-btn" onclick="openStudentModal()">+ Thêm sinh viên</button>
                </div>

                <div class="search-row">
                    <input type="text" class="search-input" id="search-students" placeholder="Tìm sinh viên theo tên, username..." oninput="onSearch('students')">
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th onclick="onSort('students', 'username')">Username</th>
                            <th onclick="onSort('students', 'display_name')">Họ tên</th>
                            <th onclick="onSort('students', 'solved_count')">Đã giải</th>
                            <th onclick="onSort('students', 'submission_count')">Tổng nộp</th>
                            <th onclick="onSort('students', 'main_lang')">Ngôn ngữ</th>
                            <th>Mật khẩu</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="students-body"></tbody>
                </table>

                <div class="pagination-row" id="pagination-students"></div>
            </div>

            <div id="tab-submissions" class="admin-tab" style="display: none;">
                <h2>Lịch sử chi tiết</h2>

                <div class="search-row">
                    <input type="text" class="search-input" id="search-submissions" placeholder="Tìm kiếm SV, bài tập, ngôn ngữ..." oninput="onSearch('submissions')">
                    <select class="search-input" id="filter-submissions-lang" onchange="onFilter('submissions')" style="flex: 0 0 150px;">
                        <option value="all">Ngôn ngữ</option>
                        <option value="python">Python</option>
                        <option value="c">C</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                        <option value="csharp">C#</option>
                    </select>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th onclick="onSort('submissions', 'username')">Sinh viên</th>
                            <th onclick="onSort('submissions', 'problemTitle')">Bài tập</th>
                            <th onclick="onSort('submissions', 'language')">Ngôn ngữ</th>
                            <th onclick="onSort('submissions', 'timestamp')">Thời gian</th>
                            <th>Kết quả</th>
                        </tr>
                    </thead>
                    <tbody id="submissions-body"></tbody>
                </table>

                <div class="pagination-row" id="pagination-submissions"></div>
            </div>

            <!-- Reports Tab -->
            <div id="tab-reports" class="admin-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Báo cáo chi tiết</h2>
                    <div class="search-row" style="margin:0">
                        <button class="secondary-btn active" id="btn-report-students" onclick="toggleReportView('students')">Bảng xếp hạng SV</button>
                        <button class="secondary-btn" id="btn-report-problems" onclick="toggleReportView('problems')">Thống kê bài tập</button>
                    </div>
                </div>

                <div id="tab-reports_students">
                    <div class="search-row">
                        <input type="text" class="search-input" id="search-reports_students" placeholder="Tìm sinh viên theo tên..." oninput="onSearch('reports_students')">
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th onclick="onSort('reports_students', 'rank')">Hạng</th>
                                <th onclick="onSort('reports_students', 'display_name')">Sinh viên</th>
                                <th onclick="onSort('reports_students', 'solved_count')">Đã giải</th>
                                <th onclick="onSort('reports_students', 'submission_count')">Tổng nộp</th>
                                <th onclick="onSort('reports_students', 'success_rate')">Tỷ lệ thành công</th>
                            </tr>
                        </thead>
                        <tbody id="reports_students-body"></tbody>
                    </table>
                    <div class="pagination-row" id="pagination-reports_students"></div>
                </div>

                <div id="tab-reports_problems" style="display: none;">
                    <div class="search-row">
                        <input type="text" class="search-input" id="search-reports_problems" placeholder="Tìm bài tập theo tên, ID..." oninput="onSearch('reports_problems')">
                        <select class="search-input" id="filter-reports_problems-difficulty" onchange="onFilter('reports_problems')" style="flex: 0 0 150px;">
                            <option value="all">Độ khó</option>
                            <option value="Dễ">Dễ</option>
                            <option value="Trung bình">Trung bình</option>
                            <option value="Khó">Khó</option>
                        </select>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th onclick="onSort('reports_problems', 'id')">ID</th>
                                <th onclick="onSort('reports_problems', 'title')">Tên bài tập</th>
                                <th onclick="onSort('reports_problems', 'difficulty')">Mức độ</th>
                                <th onclick="onSort('reports_problems', 'attempt_count')">Tổng lượt nộp</th>
                                <th onclick="onSort('reports_problems', 'pass_count')">Số SV đã giải</th>
                            </tr>
                        </thead>
                        <tbody id="reports_problems-body"></tbody>
                    </table>
                    <div class="pagination-row" id="pagination-reports_problems"></div>
                </div>
            </div>
            <!-- Student Detail View -->
            <div id="tab-student-detail" class="admin-tab" style="display: none;">
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
                    <button class="secondary-btn" onclick="showTab('students')">&larr; Quay lại</button>
                    <h2 id="student-detail-name">Thống kê chi tiết: [Tên SV]</h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="label">Bài tập đã giải</div>
                        <div class="value" id="student-stat-solved">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Tổng số lần nộp</div>
                        <div class="value" id="student-stat-subs">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Ngôn ngữ chính</div>
                        <div class="value" id="student-stat-lang">--</div>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-container">
                        <h3>Phân bổ ngôn ngữ</h3>
                        <div id="student-lang-stats" class="lang-bar-wrapper"></div>
                    </div>
                    <div class="chart-container">
                        <h3>Hoạt động gần đây</h3>
                        <table class="data-table" style="font-size: 0.9rem;">
                            <thead>
                                <tr><th>Bài tập</th><th>Ngôn ngữ</th><th>Thời gian</th></tr>
                            </thead>
                            <tbody id="student-activity-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="student-modal" class="modal">
        <div class="modal-content" style="width: 400px;">
            <h3 id="student-modal-title">Thêm sinh viên</h3>
            <div style="margin-top: 1.5rem;">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">Tên đăng nhập (Username)</label>
                    <input type="text" id="s-user" class="search-input" style="width: 100%" placeholder="vd: sv01">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">Họ và tên</label>
                    <input type="text" id="s-name" class="search-input" style="width: 100%" placeholder="vd: Nguyễn Văn A">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">Mật khẩu</label>
                    <input type="text" id="s-pass" class="search-input" style="width: 100%" placeholder="Nhập để đặt/đổi mật khẩu">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="secondary-btn" onclick="closeModals()">Hủy</button>
                    <button class="primary-btn" onclick="saveStudent()">Lưu thay đổi</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/admin/js/admin.js"></script>
</body>
</html>
